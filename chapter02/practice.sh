#!/bin/bash
# ↑ シバン（shebang）
# このファイルを「./script.sh」のように直接実行したとき、
# どのインタプリタで実行するかをOSに伝える行である。
#
# 注意：
# - 元の `#!/bin/BASH` は通常の環境では存在しないパスであり、実行時に失敗する可能性が高い。
# - 一般的には `/bin/bash` または `/usr/bin/env bash` を使う。
#   - /bin/bash   : bash がそこにある前提（多くのLinuxでOK）
#   - env bash    : PATH から bash を探すので移植性が少し上がる

# tcpdump：パケットキャプチャツール
# ここでは「ローカルループバック(lo)上で、TCP/UDPの 55555 番ポートに関する通信」を観測する。
#
# この1行でやっていること（全体の流れ）：
# 1) 監視インタフェースとして lo を選ぶ（自分のPC内で完結する通信を見る）
# 2) BPFフィルタ `port 55555` を適用して、対象ポートの通信だけに絞る
# 3) 受け取った各パケットを、追加情報付きで（ASCII/HEX表示など）標準出力に表示する
#
# 各オプションの意味：
# - -X : パケット内容を 16進 + ASCII でダンプ表示する
#        アプリ層のデータ（例：送った文字列）が見えるので、プロトコルの学習に便利。
# - -S : TCPのシーケンス番号を相対値ではなく「絶対値」で表示する
#        通信の追跡や再送・順序の理解に役立つ。
# - -t : タイムスタンプを表示しない（出力を簡潔にする）
#        逆に時刻が必要なら外す。
# - -n : ホスト名解決 / サービス名解決をしない（数値のまま表示）
#        DNSや /etc/services を引かないので速いし、出力も分かりやすい。
# - -i lo : 監視するネットワークインタフェースを lo（loopback）にする
#          例：client と server を同一マシンで動かしているときに lo に流れる通信が見える。
# - port 55555 : BPFフィルタ（キャプチャ対象の絞り込み条件）
#                実務的には「必要な通信だけを見る」のが大事なので、フィルタは基本入れる。
#
# よくある使い方（例）：
# - 端末A：サーバを 55555 で起動
# - 端末B：このスクリプトでキャプチャ開始
# - 端末C：クライアントから 55555 に接続してデータ送信
# すると、TCPの3-way handshake（SYN/SYN-ACK/ACK）や送受信データが見える。
#
# 追加で便利な改善案：
# - より詳細にTCPフラグ等を見たいなら `-vvv` を付ける
# - 長いパケットも切らずに見たいなら `-s 0`（snaplen無制限相当）を付ける
#   例：sudo tcpdump -s 0 -X -S -t -n -i lo port 55555
sudo tcpdump -X -S -t -n -i lo port 55555 | tee log.log
